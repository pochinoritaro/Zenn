---
title: "Bolt for Pythonã®è½ã¨ã—ç©´"
emoji: "ğŸ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["python", "slack", "Bolt"]
published: false
---
# ç’°å¢ƒæƒ…å ±
Docker Composeã§ä½œæˆã—ã¦ã„ã¾ã™ã€‚

## Docker Composeã§ç™»éŒ²ã—ã¦ã„ãŸç’°å¢ƒå¤‰æ•°
ä»¥ä¸‹ã®ã‚ˆã†ã«è¨­å®šã—ã¦ã„ã¾ã—ãŸã€‚
```.env: .env
SLACK_CLIENT_ID=xxxxxxxxxxxxx.xxxxxxxxxxxxx
SLACK_CLIENT_SECRET=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
SLACK_SIGNING_SECRET=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
SLACK_BOT_TOKEN=xoxb-xxxxxxxxxxxxx-xxxxxxxxxxxxx-xxxxxxxxxxxxxxxxxxxxxxxx
```

## ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æ§‹æˆ
- **Python**: 3.12.8
- **fastapi**: 0.110.0
- **slack_bolt**: 1.21.3
- **slack_sdk**: 3.33.5
- **uvicorn**: 0.27.1


## ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰
```py: app.py
from os import environ
from fastapi import FastAPI, Request
from slack_bolt import App
from slack_bolt.adapter.fastapi import SlackRequestHandler


bolt_app = App(
    token=environ.get("SLACK_BOT_TOKEN"),
    signing_secret=environ.get("SLACK_SIGNING_SECRET"),
    installation_store=None,
    authorize=None
)

# for debug.
print("Bolt App Token:", bolt_app._token)
print("Bolt App Signing Secret:", bolt_app._signing_secret)


app_handler = SlackRequestHandler(bolt_app)
fast_api = FastAPI()


@fast_api.post("/slack/commands")
async def slack_events_endpoint(request: Request):
    return await app_handler.handle(request)

@bolt_app.command("/test")
def handle_test_command(ack, body, say):
    ack()
    say(f"Hello, <@{body['user_id']}>! Your command works!")

if __name__ == "__main__":
    import uvicorn
    uvicorn.run(app="app:fast_api", host="0.0.0.0", port=3040, reload=True)
```

# ç™ºç”Ÿã—ãŸå•é¡Œ
ã‚¢ãƒ—ãƒªèµ·å‹•å¾Œã€Slackä¸Šã§ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒã‚ã£ãŸã€‚
![](/images/91e6d8f0b1be80/failed_response.png)
DeepLç¿»è¨³æ›°ãã€ã€Œç”³ã—è¨³ã”ã–ã„ã¾ã›ã‚“ãŒã€åŸå› ä¸æ˜ã®ç†ç”±ã«ã‚ˆã‚Šã€ã“ã®ã‚¢ãƒ—ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã“ã¨ãŒã§ããªããªã‚Šã¾ã—ãŸã€‚ ã“ã®ã‚¢ãƒ—ãƒªã‚’ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã«å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãã ã•ã„ã€‚ã€ã¨ã®ã“ã¨ã€‚

## ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ç¢ºèª
ãƒ­ã‚°ã‚’ç¢ºèªã—ãŸã¨ã“ã‚ä¸‹è¨˜ã®çŠ¶æ…‹ã«ãªã£ã¦ã„ãŸã€‚
```
root@xxxxxxxxxxxx:/app# /usr/local/bin/python /app/app.py
As installation_store or authorize has been used, token (or SLACK_BOT_TOKEN env variable) will be ignored.
INFO:     Will watch for changes in these directories: ['/app']
INFO:     Uvicorn running on http://0.0.0.0:3040 (Press CTRL+C to quit)
INFO:     Started reloader process [7487] using WatchFiles
As installation_store or authorize has been used, token (or SLACK_BOT_TOKEN env variable) will be ignored.
As installation_store or authorize has been used, token (or SLACK_BOT_TOKEN env variable) will be ignored.
INFO:     Started server process [7494]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
```

## åŸå› åˆ†æ
ä¸Šè¨˜ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€ŒAs installation_store or authorize has been used, token (or SLACK_BOT_TOKEN env variable) will be ignored.ã€ãŒåŸå› ã§ã‚ã‚‹å¯èƒ½æ€§ãŒé«˜ã„ãŸã‚ã€
ã“ã‚Œã«é–¢é€£ã™ã‚‹æƒ…å ±ã‚’èª¿æŸ»ã™ã‚‹ã¨ã€Stack Over Flowã«ä»¥ä¸‹ã®è¨˜äº‹ãŒè¦‹ã¤ã‹ã£ãŸã€‚
https://stackoverflow.com/questions/74716129/slack-bolt-python-although-the-app-should-be-installed-into-this-workspace-th


# è§£æ±ºç­–
boltã®Appã¯åˆæœŸåŒ–æ™‚ã«ç’°å¢ƒå¤‰æ•°ã®`SLACK_CLIENT_ID`ã¨`SLACK_CLIENT_SECRET`ãŒã‚ã‚Œã°å„ªå…ˆã—ã¦OAuthAppã¨ã—ã¦èµ·å‹•ã™ã‚‹ãŸã‚ã€
`SLACK_CLIENT_ID`ã¨`SLACK_CLIENT_SECRET`ã‚’å‰Šé™¤ã—ãŸã¨ã“ã‚æ­£å¸¸ã«å‹•ä½œã—ã¾ã—ãŸã€‚

## ã¾ã¨ã‚
1. ç’°å¢ƒå¤‰æ•°åã«ä»¥ä¸‹ã‚’ä½¿ç”¨ã›ãšç‹¬è‡ªã®å¤‰æ•°åã§ç™»éŒ²ã—ã€os.environç­‰ã§å‘¼ã³å‡ºã™ã€‚
     - **SLACK_CLIENT_ID**
     - **SLACK_CLIENT_SECRET**
     - **SLACK_SIGNING_SECRET**
     - **SLACK_BOT_TOKEN**
<br>

2. ç’°å¢ƒå¤‰æ•°ã«`SLACK_BOT_TOKEN`ã¨`SLACK_SIGNING_SECRET`ã®ã¿ã‚’ç™»éŒ²ã™ã‚‹ã€‚
